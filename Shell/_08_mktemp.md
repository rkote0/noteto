# mktemp

>  Bash 脚本有时需要创建临时文件或临时目录

生成临时文件应该遵循下面的规则。

> - 创建前检查文件是否已经存在。
> - 确保临时文件已成功创建。
> - 临时文件必须有权限的限制。
> - 临时文件要使用不可预测的文件名。
> - 脚本退出时，要删除临时文件（使用`trap`命令）。

## mktemp 命令的用法

`mktemp`命令就是为安全创建临时文件而设计的。虽然在创建临时文件之前，它不会检查临时文件是否存在，但是它支持唯一文件名和清除机制，因此可以减轻安全攻击的风险。

直接运行`mktemp`命令，就能生成一个临时文件。

```bash
$ mktemp                                                           
/tmp/tmp.VBG809f3AC

$ ls -l /tmp/tmp.VBG809f3AC 
-rw------- 1 rth0 rth0    0 Jun  3 21:09 tmp.VBG809f3AC 
```

> `mktemp`命令生成的临时文件名是随机的，而且权限是只有用户本人可读写



## 参数

```
-d : 参数可以创建一个临时目录
-p : 参数可以指定临时文件所在的目录,默认是使用$TMPDIR环境变量指定的目录，如果这个变量没设置，那么使用/tmp目录。
-t : 参数可以指定临时文件的文件名模板，模板的末尾必须至少包含三个连续的X字符，表示随机字符，建议至少使用六个X。默认的文件名模板是tmp.后接十个随机字符。
mktemp -t file.XXXXXXXXX
```



## Sell 脚本用法

> `mktemp`命令后面最好使用 OR 运算符（`||`），保证创建失败时退出脚本
>
> 为了保证脚本退出时临时文件被删除，可以使用`trap`命令指定退出时的清除操作

```bash
#!/bin/bash

trap 'rm -f "$TMPFILE"' EXIT

TMPFILE=$(mktemp) || exit 1
echo "Our temp file is $TMPFILE"
```